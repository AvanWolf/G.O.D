<?xml version="1.0" ?>
<!DOCTYPE TranscendenceExtension
[
    <!ENTITY modGODModuleRestore      "0xDCBA0510">
]>

<TranscendenceExtension
  UNID="&modGODModuleRestore;"
  name="G.O.D. Module - Restore"
  credits="alterecco"
  version="1.0">

<!--
;   License:
;     Public Domain - alterecco@gmail.com - 2010
-->

  <Globals>
    (block (module)

    (setq module (list
      '((weight     0)
        (title      "Complete Restore")
        (subtitle   (cat
          "Restore your ship completely.\n"
          "Refuel, fix damage/items, remove negative states, "
          "reset Domina powers and various timers, "
          "fix bad ranks and standings.\n"
          "Credits for this function goes to PM from Transcendence Forums!"
        ))
        (action      (block nil
          (god/restore-target gPlayerShip)
          (dsf/description "Your ship has been completely restored.\n\n Thanks PM!!")
        )))

      '((weight     0)
        (title      "Refuel")
        (subtitle   "Refuel your reactor.\nIf it is not fully refueled, contact me!")
        (action     (block nil
          (god/refuel-player)
          (dsf/description "Your Reactor has been refueled")
        )))

      '((weight     0)
        (title      "Restore Target")
        (subtitle   "Restore your current target completely")
        (hide       (not (objGetTarget gPlayerShip)))
        (action     (block nil
          (god/restore-target (objGetTarget gPlayerShip))
          (dsf/description "Your target has been restored")
        )))

    ))

    (setq god/modules (if (isError god/modules)
      module
      (append god/modules module)
    ))

    (setq god/restore-target (lambda (target)
      (block nil

        (if (objIsShip target) (block nil
          ;; fix states
          (objFixParalysis target)
          (shpFixBlindness target)
          (shpDecontaminate target)

          ;; repair shields
          (shpRechargeShield target 99999999)

          ; repair all items/devices
          (objEnumItems target "*~a D" itm (shpRepairItem target itm))

          ;; refuel
          (if (eq gPlayerShip target) (block nil
            (god/refuel-player)

            ;; fix domina and ranks
            (typSetGlobalData &stDomina; "lastInvokeTime1" 0)
            (typSetGlobalData &stDomina; "lastInvokeTime2" 0)
            (typSetGlobalData &stDomina; "lastInvokeTime3" 0)
            (typSetGlobalData &stDomina; "lastInvokeTime4" 0)
            (typSetGlobalData &stDomina; "lastInvokeTime5" 0)
            (typSetGlobalData &stDomina; "lastInvokeTime6" 0)

          ))
        ))

        ;; repair armor
        (objEnumItems target "a" armor
          (objRepairArmor target armor)
        )

      )
    ))

    (setq god/refuel-player (lambda nil
      ;; pump it full of Longzhu's
      (shpRefuelFromItem gPlayerShip (itmCreate &itLongzhuSphere; 2000))
    )))

    )
  </Globals>

</TranscendenceExtension>
<!--
vim:ts=2:sw=2:sts=2:ft=tscript:
-->
